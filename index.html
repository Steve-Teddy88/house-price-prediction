<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üè† House Price Prediction</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: linear-gradient(135deg, #f2fcfe 0%, #1c92d2 100%);
      margin: 0; padding: 0; color: #183153;
      min-height: 100vh;
    }
    .container {
      max-width: 660px; margin: 32px auto; background: #fff; border-radius: 16px;
      box-shadow: 0 8px 24px rgba(30,71,120,0.09);
      padding: 32px 24px;
    }
    h1 { text-align: center; font-size: 2.5rem; margin-bottom: 0.7em; }
    form { display: flex; flex-direction: column; gap: 18px; }
    label { font-weight: 600; margin-bottom: 0.2em; }
    input[type='number'] { padding: 12px; border-radius: 7px; border: 1px solid #d3e0ea; width: 100%; box-sizing: border-box; font-size: 1.1rem; }
    button {
      background: linear-gradient(90deg, #4ECDC4, #45B7D1);
      color: #fff; padding: 14px 0; border: none; border-radius: 8px;
      font-size: 1.15rem; cursor: pointer; font-weight: bold; letter-spacing: 1px;
      transition: background .2s, transform .1s;
    }
    button:active {transform: scale(0.98);}
    .result, .error {text-align:center; margin-top: 18px; font-size:1.2rem;}
    .result { color: #21b573; }
    .error { color: #e94e77; }
    .vis-section {margin-top: 40px;}
    .upload-section { margin-bottom: 22px; }
    @media (max-width: 750px) {
      .container { padding: 18px 6px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üè† House Price Predictor</h1>
    <div class="upload-section">
      <label for="csvFile">Predict from CSV file<br><small style="font-weight:400;color:#517fa4;">Format: 8 columns, no header</small></label>
      <input type="file" id="csvFile" accept=".csv" />
    </div>
    <form id="predictForm">
      <div id="inputs"></div>
      <button type="submit">Predict Price</button>
    </form>
    <div class="result" id="predictionResult"></div>
    <div class="error" id="errorMsg"></div>
    <div class="vis-section">
      <h2 style="font-size:1.3rem">Visualizations</h2>
      <img src="house_price_prediction_analysis.png" alt="Data/Model Analysis Visualization" style="width:100%;border-radius:8px;box-shadow:0 4px 16px #123c5419;margin-top:12px;" onerror="this.style.display='none'" />
      <div style="font-size:0.98rem;color:#777;margin-top:12px;">(If this visualization doesn't show, it may need to be generated by running the ML pipeline.)</div>
    </div>
  </div>
  <script>
    // California Housing feature names
    const FEATURES = [
      'MedInc','HouseAge','AveRooms','AveBedrms','Population','AveOccup','Latitude','Longitude'
    ];
    const INPUTS_DIV = document.getElementById('inputs');
    function renderInputs() {
      INPUTS_DIV.innerHTML = '';
      FEATURES.forEach(f => {
        const label = document.createElement('label');
        label.textContent = f;
        const input = document.createElement('input');
        input.type = 'number'; input.step = 'any'; input.required = true; input.name = f;
        if(f === 'Latitude') { input.min = 32; input.max = 42; }
        if(f === 'Longitude') { input.min = -124; input.max = -114; }
        INPUTS_DIV.appendChild(label);
        INPUTS_DIV.appendChild(input);
      });
    }
    renderInputs();
    // Predict form
    document.getElementById('predictForm').onsubmit = async (e) => {
      e.preventDefault();
      document.getElementById('errorMsg').textContent = '';
      const vals = Array.from(INPUTS_DIV.querySelectorAll('input')).map(inp=> Number(inp.value));
      if(vals.some(isNaN)) { document.getElementById('errorMsg').textContent = 'Fill out all fields.'; return; }
      document.getElementById('predictionResult').textContent = 'Predicting...';
      try {
        const resp = await fetch('/api/predict', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({features: vals}) });
        const data = await resp.json();
        if(data.prediction !== undefined) {
          document.getElementById('predictionResult').textContent = `Predicted House Price: $${(data.prediction * 100000).toLocaleString()}`;
        } else {
          document.getElementById('predictionResult').textContent = '';
          document.getElementById('errorMsg').textContent = data.error || 'Prediction failed.';
        }
      } catch(err) {
        document.getElementById('predictionResult').textContent = '';
        document.getElementById('errorMsg').textContent = 'Error connecting to API.';
      }
    };
    // CSV upload handler
    document.getElementById('csvFile').addEventListener('change', e => {
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = async evt => {
        const rows = evt.target.result.trim().split(/\r?\n/);
        if(!rows.length) return;
        document.getElementById('predictionResult').innerHTML = '';
        document.getElementById('errorMsg').textContent = '';
        let html = `<b>CSV Predictions:</b><br><table style='margin:0.5em 0;width:100%;border-collapse:collapse;'><tr>`;
        FEATURES.forEach(f=>{html+=`<th style='padding:4px;border:1px solid #ccc;'>${f}</th>`});
        html+='<th>Price ($)</th></tr>';
        for(let row of rows) {
          let vals = row.split(',').map(Number);
          if(vals.length!==8) continue;
          try {
            const resp = await fetch('/api/predict', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({features: vals}) });
            const data = await resp.json();
            html += '<tr>' + vals.map(v=>`<td style='border:1px solid #eee;text-align:center;'>${v}</td>`).join('') + `<td style='font-weight:bold;border:1px solid #eee;text-align:center;'>$${data.prediction ? (data.prediction*100000).toLocaleString() : '?'}</td></tr>`;
          } catch {
            html += '<tr><td colspan="9" style="color:red;">Error predicting for row.</td></tr>';
          }
        }
        html+='</table>';
        document.getElementById('predictionResult').innerHTML = html;
      };
      reader.readAsText(file);
    });
  </script>
</body>
</html>